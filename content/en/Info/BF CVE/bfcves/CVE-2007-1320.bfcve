<?xml version="1.0" encoding="utf-8"?>
<BFCVE ID="CVE-2007-1320" Title="&quot;BitBlt&quot; heap overflow in the Cirrus VGA extension in QEMU 0.8.2" Description="Missing verification of pointers towards a upper limit leads to use of an inconsistent size for an object, allowing a pointer reposition over its bounds, which, when used to to mark non-existent regions as dirty leads to  a heap buffer overflow. If exploited, this can lead to arbitrary code execution." Author="Irena Bojanova" Date="2023-12-04T20:28:58" Score="7.2" Criteria="qemu:qemu" BugReport="https://lists.opensuse.org/archives/list/security-announce@lists.opensuse.org/message/4523S5QJR2GSDHZAA3ER67FQM6U7VH5R/" CodeWithBug="" CodeWithFix="https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef">
  <DefectWeakness Class="DVR" ClassType="_INP" Language="C" File="https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL642&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL657&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL674&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL693-L694&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL744-L745&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL771-L772&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL804-L805&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL1923&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL1946" Trace="" Line="hw/cirrus_vga.cL642, 657, 674, 693-694,744-745, 771-772, 804-805, 1923, 1946">
    <Cause Comment="to check pointer is not over bound" Type="Code Defect">Missing Code</Cause>
    <Operation Comment="fixed with truncation via &#xD;&#xA;'&amp; s-&gt;cirrus_addr_mask'">Verify</Operation>
    <Consequence Type="Data">Wrong Value</Consequence>
    <Attributes>
      <Operand Name="Data">
        <Attribute Type="State">In Use</Attribute>
      </Operand>
      <Operation>
        <Attribute Comment="fixed with trancation via &#xD;&#xA;'&amp; s-&gt;cirrus_addr_mask'" Type="Mechanism">Range</Attribute>
        <Attribute Comment="hw/cirrus_vga.cL642, 657, 674, 693-694,744-745, 771-772, 804-805, 1923, 1946" Type="Source Code">Codebase</Attribute>
        <Attribute Comment="Xen bare-metal hypervisor" Type="Execution Space">Bare-Metal</Attribute>
      </Operation>
    </Attributes>
  </DefectWeakness>
  <Weakness Class="MAD" ClassType="_MEM" Language="C" File="https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL642&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL657&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL674&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL693-L694&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL744-L745&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL771-L772&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL804-L805&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL1923&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL1946" Trace="" Line="hw/cirrus_vga.c">
    <Cause Type="Data">Wrong Size</Cause>
    <Operation Comment="e.g., 'while (off_cur &lt; off_cur_end) {cpu_physical_memory_set_dirty(s-&gt;vram_offset + off_cur);'">Reposition</Operation>
    <Consequence Type="Address">Over Bounds Pointer</Consequence>
    <Attributes>
      <Operand Name="Address">
        <Attribute Type="State">Heap</Attribute>
      </Operand>
      <Operand Name="Size">
        <Attribute Type="Kind">Used</Attribute>
      </Operand>
      <Operation>
        <Attribute Type="Mechanism">Direct</Attribute>
        <Attribute Comment="hw/cirrus_vga.c" Type="Source Code">Codebase</Attribute>
        <Attribute Comment="Xen bare-metal hypervisor" Type="Execution Space">Bare-Metal</Attribute>
      </Operation>
    </Attributes>
  </Weakness>
  <Weakness Class="MUS" ClassType="_MEM" Language="C" File="https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL642&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL657&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL674&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL693-L694&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL744-L745&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL771-L772&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL804-L805&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL1923&#xD;&#xA;https://github.com/rarnu/QEMU-s5l89xx-port/commit/b2eb849d4b1fdb6f35d5c46958c7f703cf64cfef#diff-770cc4137e9afc7b8f2d3f16028c920ae2e674106ee89824871643bfa58f777dL1946" Trace="" Line="hw/cirrus_vga.c">
    <Cause Type="Address">Over Bounds Pointer</Cause>
    <Operation Comment="e.g., 'cpu_physical_memory_set_dirty(s-&gt;vram_offset + off_cur)'">Write</Operation>
    <Consequence Type="Memory Corruption/Disclosure">Buffer Overflow</Consequence>
    <Attributes>
      <Operation>
        <Attribute Type="Mechanism">Direct</Attribute>
        <Attribute Comment="hw/cirrus_vga.c" Type="Source Code">Codebase</Attribute>
        <Attribute Comment="Xen bare-metal hypervisor" Type="Execution Space">Bare-Metal</Attribute>
      </Operation>
    </Attributes>
  </Weakness>
  <Failures ClassType="_FLR">
    <Cause Type="Memory Corruption/Disclosure">Buffer Overflow</Cause>
    <Failure Class="ACE" />
  </Failures>
</BFCVE>